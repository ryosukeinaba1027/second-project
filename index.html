<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ¶é™åŒºåŸŸå†…å®‰å…¨ã‚¯ã‚¤ã‚ºï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆ - 0åŸ‹ã‚å¯¾å¿œï¼‰</title>
    <style>
        /* ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆã¯çœç•¥ */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7f6;
            color: #333;
            margin: 0;
            padding: 10px;
        }
        .quiz-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #ffffff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #004d99;
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #004d99;
            padding-bottom: 8px;
            font-size: 1.5em;
        }
        h2 {
            color: #007bff;
            border-bottom: 1px dashed #ccc;
            padding-bottom: 5px;
            margin-top: 20px;
            font-size: 1.2em;
        }
        .question-card {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        .question-text {
            font-size: 1em;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        .answer-option {
            display: block;
            margin-bottom: 8px;
            padding: 12px;
            border-radius: 6px;
            background-color: #fff;
            border: 1px solid #ccc;
            cursor: pointer;
            transition: background-color 0.2s;
            line-height: 1.4;
        }
        .answer-option input[type="radio"] {
            margin-right: 8px;
        }
        .answer-option:hover:not(.answered) {
            background-color: #e6f7ff;
        }
        .answer-option.answered {
            cursor: default;
        }
        .answer-option.correct {
            background-color: #d4edda;
            border-color: #1e7e34;
        }
        .answer-option.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545;
        }
        .rationale {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-size: 0.9em;
            line-height: 1.5;
            font-weight: bold;
        }
        .rationale.correct {
            background-color: #c3e6cb;
            color: #155724;
        }
        .rationale.incorrect {
            background-color: #f5c6cb;
            color: #721c24;
        }
        .submit-btn, .save-btn {
            display: block;
            width: 100%;
            padding: 12px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1.1em;
            cursor: pointer;
            margin-top: 10px;
            transition: background-color 0.2s;
            text-align: center;
        }
        .save-btn {
            background-color: #28a745;
        }
        .save-btn:hover {
            background-color: #1e7e34;
        }
        .submit-btn:hover:not(:disabled) {
            background-color: #0056b3;
        }
        .submit-btn:disabled {
            background-color: #aaa;
            cursor: not-allowed;
        }
        #results {
            margin-top: 30px;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
            padding: 20px;
            border-radius: 8px;
            background-color: #eaf3ff;
            border: 1px solid #cce5ff;
        }
        .score-info {
            font-size: 1.5em;
            color: #28a745;
        }
        .hint-text {
            margin-top: 10px;
            font-style: italic;
            color: #555;
            padding: 8px;
            border-left: 3px solid #ffc107;
            background-color: #fffbebe6;
        }
        .analysis-detail {
            text-align: left;
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f4f4f4;
        }
        .radar-chart {
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 0.9em;
            line-height: 1.6;
            background-color: #fff;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #ccc;
            margin-top: 15px;
        }
        .radar-chart .low { color: #dc3545; font-weight: bold; }
        .radar-chart .mid { color: #ffc107; font-weight: bold; }
            .radar-chart .high { color: #28a745; font-weight: bold; }
    </style>
</head>
<body>
    <div class="quiz-container">
        <h1>æ±äº¬å›½éš›ç©ºæ¸¯ åˆ¶é™åŒºåŸŸå†…å®‰å…¨ã‚¯ã‚¤ã‚º</h1>
        <form id="quiz-form">
            <div id="quiz-content">
                </div>
            <button type="button" id="show-results-btn" class="submit-btn" disabled>çµæœã‚’è¡¨ç¤º (0/10 å•è§£ç­”)</button>
        </form>
        
        <div id="results" style="display:none;">
            </div>
    </div>

    <script>
        // --- èµ·å‹•æ™‚ã«LocalStorageã®å›ç­”ãƒ‡ãƒ¼ã‚¿ã‚’å…¨ã¦ã‚¯ãƒªã‚¢ã™ã‚‹é–¢æ•° ---
        function forceClearLocalStorage() {
            for (let i = 0; i < 10; i++) {
                localStorage.removeItem(`q${i}`);
            }
        }
        forceClearLocalStorage();

        const quizData = {
          "questions": [
            {
              "questionNumber": 1,
              "question": "åˆ¶é™åŒºåŸŸå†…ã§ã®è¡Œå‹•ã«ãŠã„ã¦ã€æœ€ã‚‚å„ªå…ˆã™ã¹ãäº‹é …ã¯ä½•ã§ã™ã‹ã€‚",
              "category": "èˆªç©ºæ©Ÿå„ªå…ˆãƒ»æ¥è¿‘",
              "imageUrl": null,
              "answerOptions": [
                { "text": "å·¥äº‹ã®é€²æ—ã‚’æœ€é€Ÿã§å®Œäº†ã•ã›ã‚‹ã“ã¨", "rationale": "å·¥äº‹ã®åŠ¹ç‡ã‚‚é‡è¦ã§ã™ãŒã€åˆ¶é™åŒºåŸŸå†…ã§ã¯èˆªç©ºæ©Ÿã®å®‰å…¨ãŒå…¨ã¦ã®æ´»å‹•ã«å„ªå…ˆã•ã‚Œã¾ã™ã€‚", "isCorrect": false },
                { "text": "èˆªç©ºæ©Ÿã®é‹èˆªã‚’çµ¶å¯¾ã«å¦¨ã’ãªã„ã“ã¨", "rationale": "åˆ¶é™åŒºåŸŸå†…ã§ã¯ã€ã„ã‹ãªã‚‹å ´åˆã§ã‚‚èˆªç©ºæ©Ÿã®é‹èˆªãŒæœ€å„ªå…ˆã§ã‚ã‚Šã€ã“ã‚Œã‚’å¦¨ã’ã‚‹è¡Œç‚ºã¯å³ç¦ã§ã™ã€‚", "isCorrect": true },
                { "text": "è»Šä¸¡ã®é€šè¡Œãƒ«ãƒ¼ãƒˆã‚’å³å®ˆã—ã€é€Ÿåº¦ã‚’å‡ºã™ã“ã¨", "rationale": "åˆ¶é™é€Ÿåº¦ã®å³å®ˆã¯å¿…é ˆã§ã™ãŒã€èˆªç©ºæ©Ÿã®é‹èˆªå„ªå…ˆã¨ã„ã†åŸºæœ¬åŸå‰‡ã‚’ä¸Šå›ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚", "isCorrect": false },
                { "text": "å¤–å‘¨ãƒ•ã‚§ãƒ³ã‚¹ã«è¿‘ã¥ãã€å¯¾äººã‚»ãƒ³ã‚µãƒ¼ã®å‹•ä½œã‚’ç¢ºèªã™ã‚‹ã“ã¨", "rationale": "å¤–å‘¨ãƒ•ã‚§ãƒ³ã‚¹ã¸ã®æ¥è¿‘ã¯ã€å¯¾äººã‚»ãƒ³ã‚µãƒ¼ãŒã‚ã‚‹ãŸã‚ç¦æ­¢ã•ã‚Œã¦ã„ã¾ã™ã€‚", "isCorrect": false }
              ],
              "hint": "åˆ¶é™åŒºåŸŸå†…ã®å…¨ã¦ã®æ´»å‹•ã‚’æ”¯é…ã™ã‚‹ã€æœ€ã‚‚æ ¹æœ¬çš„ãªåŸå‰‡ã‚’æ€ã„å‡ºã—ã¾ã—ã‚‡ã†ã€‚"
            },
            {
              "questionNumber": 2,
              "question": "åˆ¶é™åŒºåŸŸå†…ã®**å ´å‘¨é“è·¯**ã‚’èµ°è¡Œã™ã‚‹éš›ã®**æœ€é«˜åˆ¶é™é€Ÿåº¦**ã¯ã„ãã‚‰ã§ã™ã‹ã€‚",
              "category": "è»Šä¸¡é‹è¡Œãƒ»é€Ÿåº¦",
              "imageUrl": null,
              "answerOptions": [
                { "text": "æ™‚é€Ÿ30 km/h", "rationale": "æ™‚é€Ÿ30 km/hã¯ã€è»Šä¸¡é€šè·¯ã‚„ä¿å®‰é“è·¯ã®åˆ¶é™é€Ÿåº¦ã§ã™ã€‚", "isCorrect": false },
                { "text": "æ™‚é€Ÿ15 km/h", "rationale": "æ™‚é€Ÿ15 km/hã¯ã€ãƒãƒªãƒ³ãƒˆãƒ³ãƒãƒ«ã‚„èˆªç©ºæ©Ÿå‘¨è¾ºã®åˆ¶é™é€Ÿåº¦ã§ã™ã€‚", "isCorrect": false },
                { "text": "æ™‚é€Ÿ40 km/h", "rationale": "å ´å‘¨é“è·¯ã¯ç©ºæ¸¯æ–½è¨­ã®ç¶­æŒç®¡ç†ã®ãŸã‚ã«è¨­ã‘ã‚‰ã‚ŒãŸé“è·¯ã§ã‚ã‚Šã€æœ€é«˜åˆ¶é™é€Ÿåº¦ã¯æ™‚é€Ÿ40 km/hã§ã™ã€‚", "isCorrect": true },
                { "text": "æ™‚é€Ÿ50 km/h", "rationale": "åˆ¶é™åŒºåŸŸå†…ã§ã®åˆ¶é™é€Ÿåº¦ã¯ã€æœ€ã‚‚é€Ÿã„å ´å‘¨é“è·¯ã§ã‚‚æ™‚é€Ÿ40 km/hã§ã™ã€‚", "isCorrect": false }
              ],
              "hint": "è»Šä¸¡ãŒé€šè¡Œã§ãã‚‹é“ã®ã†ã¡ã€æœ€ã‚‚åºƒã„ç¯„å›²ã®é“è·¯ã®åˆ¶é™é€Ÿåº¦ã‚’æ€ã„å‡ºã—ã¾ã—ã‚‡ã†ã€‚"
            },
            {
              "questionNumber": 3,
              "question": "åˆ¶é™åŒºåŸŸå†…ã§ä½œæ¥­å“¡ãŒå¸¸ã«æºå¸¯ã—ã€èº«ã«ã¤ã‘ã¦ã„ãªã‘ã‚Œã°ãªã‚‰ãªã„ã‚‚ã®ã¯ä½•ã§ã™ã‹ã€‚",
              "category": "IDãƒ»è­˜åˆ¥ãƒ»è³‡æ ¼",
              "imageUrl": null,
              "answerOptions": [
                { "text": "è»Šä¸¡ç”¨ã®è­˜åˆ¥æ——", "rationale": "è»Šä¸¡è­˜åˆ¥æ——ã¯è»Šä¸¡ã«è£…ç€ã™ã‚‹ã‚‚ã®ã§ã€ä½œæ¥­å“¡ãŒèº«ã«ã¤ã‘ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚", "isCorrect": false },
                { "text": "å…¬çš„è¨¼æ˜æ›¸ï¼ˆé‹è»¢å…è¨±è¨¼ãªã©ï¼‰ã®ã‚³ãƒ”ãƒ¼", "rationale": "å…¬çš„è¨¼æ˜æ›¸ã¯æœ¬äººç¢ºèªã«ä½¿ç”¨ã—ã¾ã™ãŒã€å¸¸ã«èº«ã«ã¤ã‘ã‚‹ã®ã¯å€‹äººè­˜åˆ¥ç¥¨ã¨IDã‚«ãƒ¼ãƒ‰ã§ã™ã€‚", "isCorrect": false },
                { "text": "å€‹äººè­˜åˆ¥ç¥¨ãŠã‚ˆã³IDã‚«ãƒ¼ãƒ‰", "rationale": "å€‹äººè­˜åˆ¥ç¥¨ãŠã‚ˆã³IDã‚«ãƒ¼ãƒ‰ã¯ã€ä½œæ¥­ä¸­ã‚„é‹è»¢ä¸­ã€å¸¸ã«é¦–ã‹ã‚‰æ›ã‘ã¦æºå¸¯ã—ã¦ãŠãã“ã¨ãŒç¾©å‹™ä»˜ã‘ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚", "isCorrect": true },
                { "text": "æ‰€å±ä¼šç¤¾ã®ç¤¾å“¡è¨¼", "rationale": "ç¤¾å“¡è¨¼ã¯å…¬çš„è¨¼æ˜æ›¸ã®ä»£ã‚ã‚Šã«ã¯ãªã‚Šå¾—ãšã€åˆ¶é™åŒºåŸŸå†…ã§ã¯å€‹äººè­˜åˆ¥ç¥¨ã¨IDã‚«ãƒ¼ãƒ‰ã®æºå¸¯ãŒå¿…é ˆã§ã™ã€‚", "isCorrect": false }
              ],
              "hint": "åˆ¶é™åŒºåŸŸå†…ã¸ã®ç«‹ã¡å…¥ã‚Šã®ãŸã‚ã«ã€äº‹å‹™æ‰€ã§å—ã‘å–ã‚‹æœ€ã‚‚é‡è¦ãªèº«åˆ†è¨¼ã‚’æ€ã„å‡ºã—ã¾ã—ã‚‡ã†ã€‚"
            },
            {
              "questionNumber": 4,
              "question": "æ»‘èµ°è·¯ã‚„èª˜å°è·¯ã§è»Šä¸¡ã‚’**é§è»Š**ã™ã‚‹éš›ã€é€£çµ¡è»Šã‚„ãƒˆã‚¤ãƒ¬è»Šã¯ã€æ»‘èµ°è·¯ãƒ»èª˜å°è·¯ã«å¯¾ã—ã¦ã©ã®ã‚ˆã†ãªå‘ãã§é§è»Šã—ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã‹ã€‚",
              "category": "è»Šä¸¡é‹è¡Œãƒ»ä¸€èˆ¬ãƒ«ãƒ¼ãƒ«",
              "imageUrl": null,
              "answerOptions": [
                { "text": "æ»‘èµ°è·¯ãƒ»èª˜å°è·¯ã«å¯¾ã—ã¦ç›´è§’ï¼ˆæ­£é¢ï¼‰ã«å‘ã‘ã‚‹ã€‚", "rationale": "æ»‘èµ°è·¯ã‚„èª˜å°è·¯ã«ç›´è§’ã«é§è»Šã™ã‚‹ã“ã¨ã¯ã€é‹ç”¨ä¸Šã®å±é™ºãŒã‚ã‚‹ãŸã‚ç¦æ­¢ã•ã‚Œã¦ã„ã¾ã™ã€‚", "isCorrect": false },
                { "text": "æ»‘èµ°è·¯ãƒ»èª˜å°è·¯ã«å¯¾ã—ã¦å¹³è¡Œã«å‘ã‘ã‚‹ã€‚", "rationale": "é€£çµ¡è»Šã‚„ãƒˆã‚¤ãƒ¬è»Šã®é§è»Šã¯ã€æ»‘èµ°è·¯ãƒ»èª˜å°è·¯ã«å¯¾ã—ã¦å¹³è¡Œã«è¡Œã†ã“ã¨ãŒå®šã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚", "isCorrect": true },
                { "text": "é€²è¡Œæ–¹å‘ã«åˆã‚ã›ã¦æ–œã‚45åº¦ã«å‘ã‘ã‚‹ã€‚", "rationale": "è¦å®šã•ã‚Œã¦ã„ã‚‹é§è»Šæ–¹æ³•ã¯ã€æ»‘èµ°è·¯ãƒ»èª˜å°è·¯ã«å¯¾ã—ã¦å¹³è¡Œã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚", "isCorrect": false },
                { "text": "ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼å´ï¼ˆè·¯è‚©ï¼‰ã«å‘ã‹ã£ã¦æ­£é¢ã‹ã‚‰é§è»Šã™ã‚‹ã€‚", "rationale": "ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼å´ã«å‘ã‹ã£ã¦é§è»Šã™ã‚‹ã“ã¨ã¯ç¦æ­¢ã•ã‚Œã¦ã„ã¾ã™ã€‚", "isCorrect": false }
              ],
              "hint": "èˆªç©ºæ©Ÿã®å®‰å…¨ãªé€šè¡Œã‚’ç¢ºä¿ã™ã‚‹ãŸã‚ã«ã€è»Šä¸¡ã®æ©Ÿä½“ãŒæ»‘èµ°è·¯ã«å½±éŸ¿ã‚’ä¸ãˆãªã„ã‚ˆã†ãªå‘ãã‚’è€ƒãˆã¾ã—ã‚‡ã†ã€‚"
            },
            {
              "questionNumber": 5,
              "question": "åˆ¶é™åŒºåŸŸå†…ã§**äº‹æ•…ï¼ˆäººèº«äº‹æ•…ã‚„è»Šä¸¡äº‹æ•…ãªã©ï¼‰ãŒç™ºç”Ÿ**ã—ãŸå ´åˆã€ç¾å ´ã®ä½œæ¥­å“¡ãŒç›´ã¡ã«å–ã‚‹ã¹ãæœ€åˆã®è¡Œå‹•ã¯ä½•ã§ã™ã‹ã€‚",
              "category": "ç·Šæ€¥æ™‚ãƒ»é€šå ±",
              "imageUrl": null,
              "answerOptions": [
                { "text": "äººå‘½æ•‘åŠ©ãŠã‚ˆã³è¢«å®³æ‹¡å¤§é˜²æ­¢ã®æªç½®ã‚’æœ€å„ªå…ˆã§å®Ÿæ–½ã™ã‚‹ã€‚", "rationale": "äº‹æ•…ç™ºç”Ÿæ™‚ã€äººå‘½æ•‘åŠ©ã¨è¢«å®³æ‹¡å¤§é˜²æ­¢ãŒæœ€å„ªå…ˆã®æªç½®ã§ã‚ã‚Šã€ãã®å¾Œé€Ÿã‚„ã‹ã«å…ƒè«‹è·å“¡ã¸å ±å‘Šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚", "isCorrect": true },
                { "text": "ç¾å ´ã®çŠ¶æ³ã‚’å†™çœŸã«æ’®ã‚Šã€äº‹æ•…ç™ºç”Ÿã‹ã‚‰30åˆ†ä»¥å†…ã«å…ƒè«‹è·å“¡ã«ãƒ¡ãƒ¼ãƒ«ã§é€ã‚‹ã€‚", "rationale": "å†™çœŸæ’®å½±ã‚ˆã‚Šã‚‚ã€äººå‘½æ•‘åŠ©ã¨å£é ­ã§ã®è¿…é€Ÿãªå ±å‘ŠãŒå„ªå…ˆã•ã‚Œã¾ã™ã€‚", "isCorrect": false },
                { "text": "ç®¡åˆ¶å¡”ã«ç„¡ç·šã§ç›´æ¥é€£çµ¡ã—ã€æ»‘èµ°è·¯ã®é–‰é–ã‚’è¦è«‹ã™ã‚‹ã€‚", "rationale": "ç¾å ´ã®ä½œæ¥­å“¡ã¯ã¾ãšå…ƒè«‹è·å“¡ã«å ±å‘Šã—ã€ç®¡åˆ¶å¡”ã¸ã®é€£çµ¡ã¯å…ƒè«‹è·å“¡ã‚’é€šã—ã¦è¡Œã‚ã‚Œã¾ã™ã€‚", "isCorrect": false },
                { "text": "å‹•ã‹ã›ã‚‹è»Šä¸¡ã¯å…¨ã¦å®‰å…¨ãªå ´æ‰€ã¸ç§»å‹•ã•ã›ã€äº¤é€šã‚’ç¢ºä¿ã™ã‚‹ã€‚", "rationale": "ã‚„ã‚€ã‚’å¾—ãªã„å ´åˆã‚’é™¤ãã€äº‹æ•…ç¾å ´ã®ä¿å­˜ã‚’å›³ã‚‹ã“ã¨ã‚‚é‡è¦ã§ã™ã€‚äººå‘½æ•‘åŠ©ãŒæœ€å„ªå…ˆã§ã™ã€‚", "isCorrect": false }
              ],
              "hint": "ç·Šæ€¥æ™‚ã«ãŠã‘ã‚‹æœ€å„ªå…ˆäº‹é …ã¯ã€ä½•ã‚ˆã‚Šã‚‚äººå‘½ã«é–¢ã‚ã‚‹äº‹æŸ„ã§ã™ã€‚"
            },
            {
              "questionNumber": 6,
              "question": "åˆ¶é™åŒºåŸŸå†…ã§ã®**FODï¼ˆç•°ç‰©ãƒ»å¿˜ã‚Œç‰©ï¼‰é˜²æ­¢å¯¾ç­–**ã¨ã—ã¦ã€**èª¤ã£ã¦ã„ã‚‹ã‚‚ã®**ã¯ã©ã‚Œã§ã™ã‹ã€‚",
              "category": "FODãƒ»ç’°å¢ƒãƒ»æ–½è¨­ä¿è­·",
              "imageUrl": null,
              "answerOptions": [
                { "text": "ä½¿ç”¨ã™ã‚‹å°è»Šã¯ã‚¹ãƒˆãƒƒãƒ‘ãƒ¼ä»˜ãã®ã‚‚ã®ä»¥å¤–ã€ä½¿ç”¨ã‚’ç¦æ­¢ã™ã‚‹ã€‚", "rationale": "å°è»Šã®é€¸èµ°äº‹æ•…ã‚’é¿ã‘ã‚‹ãŸã‚ã€ã‚¹ãƒˆãƒƒãƒ‘ãƒ¼ä»˜ãä»¥å¤–ã®ä½¿ç”¨ã¯ç¦æ­¢ã•ã‚Œã¦ã„ã¾ã™ã€‚", "isCorrect": false },
                { "text": "ä½œæ¥­çµ‚äº†æ™‚ã¯ã€ä½œæ¥­å“¡ãŒæ¨ªä¸€åˆ—ã«ä¸¦ã³ã€æ–½å·¥ç¯„å›²ã®å¿˜ã‚Œç‰©ãŒãªã„ã‹æ­©ãç¢ºèªã™ã‚‹ã€‚", "rationale": "ä½œæ¥­çµ‚äº†æ™‚ã®æ–½å·¥ç¯„å›²ã®å¿˜ã‚Œç‰©ç¢ºèªã¨ã—ã¦ã€ã“ã®æ–¹æ³•ã¯æ­£å¼ã«å®šã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚", "isCorrect": false },
                { "text": "å„å·¥äº‹è»Šä¸¡ã®æŒã¡è¾¼ã¿è³‡æã¯ã€ç®¡ç†è€…ãŒãƒªã‚¹ãƒˆã‚’ä½œæˆã—ã€ãƒ€ãƒ–ãƒ«ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†ã€‚", "rationale": "æŒã¡è¾¼ã¿å“ã®ç‚¹æ¤œã®ãŸã‚ã€ä¹—è¼‰å‚™å“ç®¡ç†ç°¿ã‚’ç”¨ã„ãŸãƒ€ãƒ–ãƒ«ãƒã‚§ãƒƒã‚¯ã®å®Ÿæ–½ãŒå®šã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚", "isCorrect": false },
                { "text": "å·¥å…·ã«æ‰€å±ã‚’æ˜ç¤ºã—ã€æ»‘èµ°è·¯ã‚„èª˜å°è·¯ã®ä¸Šã«ç½®ãå¿˜ã‚Œã¦ã‚‚å•é¡Œãªã„ã€‚", "rationale": "å·¥å…·ãƒ»æ©Ÿæã‚’æ»‘èµ°è·¯ã‚„èª˜å°è·¯ä¸Šã«ç½®ãå¿˜ã‚Œã‚‹ã“ã¨ã¯FODäº‹æ•…ã«ç›´çµã™ã‚‹ãŸã‚ã€å³ç¦ã§ã™ã€‚", "isCorrect": true }
              ],
              "hint": "ç©ºæ¸¯ã§ã®ã€Œå¿˜ã‚Œç‰©ã€ã‚„ã€Œè½ä¸‹ç‰©ã€ãŒèˆªç©ºæ©Ÿã«ä¸ãˆã‚‹å½±éŸ¿ã®å¤§ãã•ã‚’è€ƒãˆã¦ãã ã•ã„ã€‚"
            },
            {
              "questionNumber": 7,
              "question": "è»Šä¸¡ã®**å¾Œé€€æ™‚**ã€å‘¨å›²ã«æ³¨æ„å–šèµ·ã™ã‚‹ãŸã‚ã«é³´ã‚‰ã™ã‚¯ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã®å›æ•°ã¯ä½•å›ã§ã™ã‹ã€‚",
              "category": "è»Šä¸¡é‹è¡Œãƒ»ä¸€èˆ¬ãƒ«ãƒ¼ãƒ«",
              "imageUrl": null,
              "answerOptions": [
                { "text": "1å›", "rationale": "1å›ã¯å‰é€²æ™‚ã®å›æ•°ã§ã™ã€‚", "isCorrect": false },
                { "text": "2å›", "rationale": "å¾Œé€€æ™‚ã¯ã€å‰é€²æ™‚ã‚ˆã‚Šã‚‚æ³¨æ„å–šèµ·ã‚’å¾¹åº•ã™ã‚‹ãŸã‚ã€ã‚¯ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã‚’2å›é³´ã‚‰ã™ã“ã¨ãŒå®šã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚", "isCorrect": true },
                { "text": "3å›", "rationale": "è¦å®šã•ã‚Œã¦ã„ã‚‹å›æ•°ã¯2å›ã§ã™ã€‚", "isCorrect": false },
                { "text": "é€£ç¶šã—ã¦é³´ã‚‰ã™", "rationale": "å¾Œé€€æ™‚ã®è¦å®šå›æ•°ã¯2å›ã§ã™ã€‚", "isCorrect": false }
              ],
              "hint": "å‰é€²ã¨å¾Œé€€ã§ã€å±é™ºåº¦ã®é«˜ã•ã«åˆã‚ã›ãŸå›æ•°ãŒå®šã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚"
            },
            {
              "questionNumber": 8,
              "question": "ãƒãƒªãƒ³ãƒˆãƒ³ãƒãƒ«ã‚„PBBï¼ˆæ­ä¹—æ©‹ï¼‰ä¸‹ãªã©ã€é«˜ã•åˆ¶é™ãŒã‚ã‚‹å ´æ‰€ã§è»Šä¸¡ã‚’èµ°è¡Œã•ã›ã‚‹éš›ã®**æœ€ã‚‚å³ã—ã„åˆ¶é™é«˜**ã¯ã„ãã‚‰ã§ã™ã‹ã€‚",
              "category": "è»Šä¸¡é‹è¡Œãƒ»é€Ÿåº¦",
              "imageUrl": null,
              "answerOptions": [
                { "text": "3.8 mä»¥ä¸‹", "rationale": "ãƒãƒªãƒ³ãƒˆãƒ³ãƒãƒ«ã€PBBä¸‹éƒ¨ã€GSEåœ°ä¸‹é€šè·¯ãªã©ã¯3.8 mä»¥ä¸‹ã§ã™ãŒã€ç¬¬2æ—…å®¢ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãƒ“ãƒ«æœ¬é¤¨å—ãƒ”ã‚¢æ¥ç¶šéƒ¨ä¸‹ã¯ã‚ˆã‚Šå³ã—ã„3.6 mä»¥ä¸‹ã§ã™ã€‚", "isCorrect": false },
                { "text": "4.5 mä»¥ä¸‹", "rationale": "4.5 mä»¥ä¸‹ã¯ã‚µã‚¦ã‚¹ãƒˆãƒ³ãƒãƒ«ã®åˆ¶é™é«˜ã§ã™ã€‚", "isCorrect": false },
                { "text": "3.6 mä»¥ä¸‹", "rationale": "ç¬¬2æ—…å®¢ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãƒ“ãƒ«æœ¬é¤¨å—ãƒ”ã‚¢æ¥ç¶šéƒ¨ä¸‹ã®åˆ¶é™é«˜ã¯3.6 mä»¥ä¸‹ã§ã‚ã‚Šã€ã“ã‚ŒãŒæœ€ã‚‚ä½ã„é«˜ã•åˆ¶é™ã§ã™ã€‚", "isCorrect": true },
                { "text": "3.0 mä»¥ä¸‹", "rationale": "åˆ¶é™é«˜ã¯å ´æ‰€ã«ã‚ˆã£ã¦ç•°ãªã‚Šã¾ã™ãŒã€æœ€ã‚‚ä½ã„ã®ã¯3.6 mä»¥ä¸‹ã§ã™ã€‚", "isCorrect": false }
              ],
              "hint": "åˆ¶é™é«˜ã¯3.8 mã®å ´æ‰€ãŒå¤šã„ã§ã™ãŒã€æ—…å®¢ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«æ¥ç¶šã™ã‚‹ç‰¹å®šç®‡æ‰€ã«ã¯ã€ã•ã‚‰ã«å³ã—ã„åˆ¶é™ãŒã‚ã‚Šã¾ã™ã€‚"
            },
            {
              "questionNumber": 9,
              "question": "æ»‘èµ°è·¯ã‚„èª˜å°è·¯ã®**ã‚»ãƒ³ã‚¿ãƒ¼ãƒ©ã‚¤ãƒ³**ã®çœŸä¸Šã«ã‚ã‚‹åŸ‹è¨­èˆªç©ºç¯ç«ï¼ˆç·‘è‰²ï¼‰ã¯ã€èµ°è¡Œã—ã¦ã‚‚ã‚ˆã„ã§ã™ã‹ã€‚",
              "category": "èˆªç©ºç¯ç«ãƒ»æ–½è¨­ä¿è­·",
              "imageUrl": null,
              "answerOptions": [
                { "text": "ã¯ã„ã€åŸ‹è¨­ç¯ç«ä¸Šãªã®ã§èµ°è¡Œã—ã¦ã‚‚å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚", "rationale": "åŸ‹è¨­ç¯ç«ã¯èµ°è¡Œå¯èƒ½ã§ã™ãŒã€ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã§ã¯ã€Œæ¥µåŠ›èµ°è¡Œã—ãªã„ã“ã¨ã€ãŒæ±‚ã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚", "isCorrect": false },
                { "text": "ã„ã„ãˆã€åŸ‹è¨­ç¯ç«ã§ã‚ã£ã¦ã‚‚ã€æ¥è§¦ãƒ»ç ´æã®å±é™ºãŒã‚ã‚‹ãŸã‚èµ°è¡Œã¯å³ç¦ã§ã™ã€‚", "rationale": "åŸ‹è¨­ç¯ç«ã¯èµ°è¡Œå¯èƒ½ã§ã™ãŒã€ã€Œæ¥µåŠ›èµ°è¡Œã—ãªã„ã“ã¨ã€ãŒæ­£ã—ã„æŒ‡ç¤ºã§ã™ã€‚", "isCorrect": false },
                { "text": "èµ°è¡Œã¯å¯èƒ½ã§ã™ãŒã€å®‰å…¨ç¢ºä¿ã®ãŸã‚**æ¥µåŠ›èµ°è¡Œã—ãªã„**ã“ã¨ãŒæœ›ã¾ã—ã„ã§ã™ã€‚", "rationale": "åŸ‹è¨­èˆªç©ºç¯ç«ä¸Šã¯èµ°è¡Œå¯èƒ½ã§ã™ãŒã€å®‰å…¨é‹ç”¨ã®ãŸã‚ã€æ¥µåŠ›èµ°è¡Œã‚’é¿ã‘ã‚‹ã‚ˆã†æŒ‡ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚", "isCorrect": true },
                { "text": "ç¯ç«ãŒåŸ‹è¨­ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€èµ°è¡Œã¯å®Œå…¨ã«ç¦æ­¢ã•ã‚Œã¦ã„ã¾ã™ã€‚", "rationale": "ç¯ç«ãŒåŸ‹è¨­ã•ã‚Œã¦ã„ã‚‹ãŸã‚èµ°è¡Œã¯å¯èƒ½ã§ã™ãŒã€æ¥µåŠ›é¿ã‘ã‚‹ã¹ãã¨ã•ã‚Œã¦ã„ã¾ã™ã€‚", "isCorrect": false }
              ],
              "hint": "èµ°è¡Œã¯å¯èƒ½ã§ã™ãŒã€ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã§ã¯ã€Œæ¨å¥¨ã€ã•ã‚Œã¦ã„ã‚‹ã‹ã€Œé¿ã‘ã‚‹ã¹ãã€ã¨ã•ã‚Œã¦ã„ã‚‹ã‹ã‚’æ€ã„å‡ºã—ã¾ã—ã‚‡ã†ã€‚"
            },
            {
              "questionNumber": 10,
              "question": "ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ãƒ¼ãƒ³ã‚’**æ¨ªæ–­**ã™ã‚‹éš›ã€æœ€ã‚‚é‡è¦ã§çµ¶å¯¾ã«å®ˆã‚‰ãªã‘ã‚Œã°ãªã‚‰ãªã„ãƒ«ãƒ¼ãƒ«ã¯ä½•ã§ã™ã‹ã€‚",
              "category": "ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ãƒ¼ãƒ³ãƒ»ç‰¹å®šåŒºåŸŸ",
              "imageUrl": null,
              "answerOptions": [
                { "text": "æ™‚é€Ÿ30 km/hã®åˆ¶é™é€Ÿåº¦ã‚’å®ˆã‚Šã€é€Ÿã‚„ã‹ã«æ¨ªæ–­ã‚’å®Œäº†ã•ã›ã‚‹ã“ã¨ã€‚", "rationale": "ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ãƒ¼ãƒ³ã®é€šéã¯è¿…é€Ÿã«è¡Œã†ã¹ãã§ã™ãŒã€ä¸€æ™‚åœæ­¢ã¨å®‰å…¨ç¢ºèªãŒæœ€ã‚‚å„ªå…ˆã•ã‚Œã¾ã™ã€‚", "isCorrect": false },
                { "text": "è‡ªåŠ›èµ°è¡Œä¸­ã®èˆªç©ºæ©ŸãŒ50 mä»¥å†…ã«è¿‘ã¥ã„ã¦ã„ã‚‹å ´åˆã®ã¿ã€åœæ­¢ç·šã§ä¸€æ™‚åœæ­¢ã™ã‚‹ã“ã¨ã€‚", "rationale": "èˆªç©ºæ©ŸãŒ100 mä»¥å†…ã«è¿‘ã¥ã„ã¦ã„ã‚‹å ´åˆã¯èµ°è¡Œç¦æ­¢ã§ã‚ã‚Šã€ã¾ãŸä¸€æ™‚åœæ­¢ã¯èˆªç©ºæ©Ÿã®æœ‰ç„¡ã«é–¢ã‚ã‚‰ãšã€åœæ­¢ç·šæ‰‹å‰ã§å¿…ãšè¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚", "isCorrect": false },
                { "text": "åœæ­¢ç·šè¡¨ç¤ºã®æ‰‹å‰ã§**å¿…ãšä¸€æ™‚åœæ­¢**ã‚’è¡Œã„ã€èˆªç©ºæ©Ÿã®èµ°è¡ŒãŒãªã„ã“ã¨ã‚’ç›®è¦–ã§ç¢ºèªã—ã¦ã‹ã‚‰æ¨ªæ–­ã™ã‚‹ã“ã¨ã€‚", "rationale": "ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ãƒ¼ãƒ³ã¯èˆªç©ºæ©Ÿã®å‹•ç·šã¨äº¤å·®ã™ã‚‹ãŸã‚ã€åœæ­¢ç·šã§ã®ä¸€æ™‚åœæ­¢ã¨å·¦å³ã®èˆªç©ºæ©Ÿèµ°è¡ŒãŒãªã„ã“ã¨ã®ç¢ºèªãŒæœ€ã‚‚é‡è¦ã§ã™ã€‚", "isCorrect": true },
                { "text": "ç®¡åˆ¶å¡”ã¨ç„¡ç·šé€£çµ¡ã‚’å–ã‚Šã€ç®¡åˆ¶å®˜ã®è¨±å¯ã‚’å¾—ã¦ã‹ã‚‰æ¨ªæ–­ã™ã‚‹ã“ã¨ã€‚", "rationale": "ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ãƒ¼ãƒ³ã¯èˆªç©ºæ©Ÿèµ°è¡ŒåŒºåŸŸå¤–ã§ã‚ã‚Šã€é€šå¸¸ã€æ¨ªæ–­ã«ç®¡åˆ¶å¡”ã®ç„¡ç·šè¨±å¯ã¯ä¸è¦ã§ã™ãŒã€ä¸€æ™‚åœæ­¢ã¨ç›®è¦–ç¢ºèªã¯å¿…é ˆã§ã™ã€‚", "isCorrect": false }
              ],
              "hint": "èˆªç©ºæ©Ÿã¨ã®è¡çªã‚’çµ¶å¯¾ã«é¿ã‘ã‚‹ãŸã‚ã«ã€é“è·¯äº¤é€šæ³•ä¸Šã®ã€Œè¸åˆ‡ã€ã®ã‚ˆã†ãªè¡Œå‹•ã‚’æ€ã„å‡ºã—ã¾ã—ã‚‡ã†ã€‚"
            }
          ]
        };
        
        // 8åˆ†é‡ã«çµ±åˆã™ã‚‹ãŸã‚ã®ãƒãƒƒãƒ”ãƒ³ã‚°
        const CATEGORY_GROUPS = {
            "IDãƒ»è­˜åˆ¥ãƒ»è³‡æ ¼": ["IDãƒ»è»Šä¸¡è­˜åˆ¥ç®¡ç†"],
            "èˆªç©ºæ©Ÿå„ªå…ˆãƒ»æ¥è¿‘": ["èˆªç©ºæ©Ÿå„ªå…ˆãƒ»æ¥è¿‘"],
            "è»Šä¸¡é‹è¡Œãƒ»ä¸€èˆ¬ãƒ«ãƒ¼ãƒ«": ["è»Šä¸¡é‹è¡Œãƒ»çµŒè·¯", "è»Šä¸¡é‹è¡Œãƒ»é€Ÿåº¦", "å¤œé–“ãƒ»å¥åº·ç®¡ç†"],
            "ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ãƒ¼ãƒ³ãƒ»ç‰¹å®šåŒºåŸŸ": ["ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ãƒ¼ãƒ³ãƒ»æ¨ªæ–­"],
            "èˆªç©ºç¯ç«ãƒ»æ–½è¨­ä¿è­·": ["èˆªç©ºç¯ç«ãƒ»æ–½è¨­ä¿è­·"],
            "FODãƒ»ç’°å¢ƒãƒ»æ–½è¨­ä¿è­·": ["FODãƒ»éºå¤±ç‰©é˜²æ­¢", "æ²¹æ¼ã‚Œãƒ»é£›æ•£é˜²æ­¢", "ç«æ°—ãƒ»é£›æ•£é˜²æ­¢"],
            "ç·Šæ€¥æ™‚ãƒ»é€šå ±": ["ç·Šæ€¥æ™‚å¯¾å¿œãƒ»é€šå ±"],
            "ç®¡åˆ¶ãƒ»ç„¡ç·šãƒ»ä¸€èˆ¬ç¦æ­¢": ["ç„¡ç·šäº¤ä¿¡ãƒ»ç®¡åˆ¶", "ä¸€èˆ¬ç¦æ­¢äº‹é …"]
        };
        
        let currentAnswers = {};
        let isQuizCompleted = false;

        function getCategoryGroup(category) {
            for (const group in CATEGORY_GROUPS) {
                if (CATEGORY_GROUPS[group].includes(category)) {
                    return group;
                }
            }
            return "ãã®ä»–";
        }

        function forceClearLocalStorage() {
            for (let i = 0; i < 10; i++) {
                localStorage.removeItem(`q${i}`);
            }
        }
        forceClearLocalStorage();

        function applyMarking(qIndex, aIndex) {
            const q = quizData.questions[qIndex];
            const qCard = document.getElementById(`question-${qIndex}`);
            const isAnswered = qIndex in currentAnswers;
            
            qCard.querySelectorAll('input[type="radio"]').forEach((radio, optIndex) => {
                const label = radio.parentElement;
                const option = q.answerOptions[optIndex];

                if (isAnswered) {
                    radio.disabled = true;
                    label.classList.add('answered');

                    if (option.isCorrect) {
                        label.classList.add('correct');
                    } else if (aIndex === optIndex) {
                        label.classList.add('incorrect');
                    }
                } else {
                    radio.disabled = false;
                    label.classList.remove('answered', 'correct', 'incorrect');
                }
            });
        }

        function initializeAnswers() {
            quizData.questions.forEach((q, index) => {
                const storedAnswer = localStorage.getItem(`q${index}`);
                if (storedAnswer !== null) {
                    const ansIndex = parseInt(storedAnswer);
                    currentAnswers[index] = ansIndex;
                    
                    const radio = document.querySelector(`input[name="question-${index}"][value="${ansIndex}"]`);
                    if (radio) {
                        radio.checked = true;
                    }
                    
                    applyMarking(index, ansIndex);
                    showInstantFeedback(index, ansIndex, true); 
                }
            });
            if (Object.keys(currentAnswers).length === quizData.questions.length) {
                isQuizCompleted = true;
            }
        }
        
        function showInstantFeedback(qIndex, aIndex, isInitialization = false) {
            const q = quizData.questions[qIndex];
            const rationaleContainer = document.getElementById(`rationale-${qIndex}`);
            let isCorrect = q.answerOptions[aIndex].isCorrect;

            if (!isInitialization) {
                applyMarking(qIndex, aIndex);
            }

            const correctOption = q.answerOptions.find(opt => opt.isCorrect);
            rationaleContainer.style.display = 'block';
            rationaleContainer.innerHTML = `
                <div class="rationale ${isCorrect ? 'correct' : 'incorrect'}">
                    <strong>${isCorrect ? 'ã€æ­£è§£ã€‘' : 'ã€ä¸æ­£è§£ã€‘'}</strong><br>
                    <strong>è§£èª¬:</strong> ${correctOption.rationale}
                </div>
            `;
            
            if (Object.keys(currentAnswers).length === quizData.questions.length && !isQuizCompleted) {
                 isQuizCompleted = true;
                 updateSubmitButton();
            }
        }

        function renderQuiz() {
            const quizContent = document.getElementById('quiz-content');
            quizContent.innerHTML = '';
            quizData.questions.forEach((q, index) => {
                const qCard = document.createElement('div');
                qCard.className = 'question-card';
                qCard.id = `question-${index}`;

                const qText = document.createElement('div');
                qText.className = 'question-text';
                qText.innerHTML = `å•${index + 1}. [${getCategoryGroup(q.category)}] ${q.question}`;
                qCard.appendChild(qText);
                
                const hintText = document.createElement('div');
                hintText.className = 'hint-text';
                hintText.textContent = `ãƒ’ãƒ³ãƒˆ: ${q.hint}`;
                qCard.appendChild(hintText);

                q.answerOptions.forEach((option, optIndex) => {
                    const label = document.createElement('label');
                    label.className = 'answer-option';
                    
                    const radio = document.createElement('input');
                    radio.type = 'radio';
                    radio.name = `question-${index}`;
                    radio.value = optIndex;
                    
                    radio.onchange = (event) => {
                        if (index in currentAnswers) {
                            return;
                        }
                        handleAnswer(index, optIndex);
                        showInstantFeedback(index, optIndex);
                    };

                    label.appendChild(radio);
                    label.appendChild(document.createTextNode(option.text));
                    qCard.appendChild(label);
                });

                const rationaleContainer = document.createElement('div');
                rationaleContainer.id = `rationale-${index}`;
                rationaleContainer.className = 'rationale-container';
                rationaleContainer.style.display = 'none';
                qCard.appendChild(rationaleContainer);

                quizContent.appendChild(qCard);
            });
            
            initializeAnswers();
            updateSubmitButton();
        }

        function handleAnswer(qIndex, aIndex) {
            currentAnswers[qIndex] = aIndex;
            localStorage.setItem(`q${qIndex}`, aIndex);
            updateSubmitButton();
        }


        function updateSubmitButton() {
            const totalQuestions = quizData.questions.length;
            const answeredCount = Object.keys(currentAnswers).length;
            const submitButton = document.getElementById('show-results-btn');
            
            submitButton.textContent = `çµæœã‚’è¡¨ç¤º (${answeredCount}/${totalQuestions} å•è§£ç­”)`;

            if (answeredCount === totalQuestions) {
                submitButton.disabled = false;
            } else {
                submitButton.disabled = true;
            }
        }


        function calculateResults() {
            const totalQuestions = quizData.questions.length;
            let score = 0;
            const results = [];
            const categoryScores = {}; 

            // 7åˆ†é‡ã™ã¹ã¦ã‚’åˆæœŸåŒ–ï¼ˆIDãƒ»è­˜åˆ¥ãƒ»è³‡æ ¼ã‚‚å«ã‚€ï¼‰
            for (const group in CATEGORY_GROUPS) {
                 // ä¿®æ­£: ã¾ãšå…¨ã¦ã®ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ {correct: 0, total: 0} ã§åˆæœŸåŒ–
                categoryScores[group] = { correct: 0, total: 0 };
            }

            quizData.questions.forEach((q, index) => {
                const selectedOptionIndex = currentAnswers[index];
                const groupName = getCategoryGroup(q.category);
                let isCorrect = false;

                q.answerOptions.forEach((option, optIndex) => {
                    if (option.isCorrect && selectedOptionIndex === optIndex) {
                        score++;
                        isCorrect = true;
                    }
                });

                // è³ªå•ã«å¯¾å¿œã™ã‚‹ã‚°ãƒ«ãƒ¼ãƒ—ã®ã¿ã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—
                if (groupName && groupName !== "ãã®ä»–") {
                    categoryScores[groupName].total++;
                    if (isCorrect) {
                        categoryScores[groupName].correct++;
                    }
                }

                results.push({
                    question: q.question,
                    isCorrect: isCorrect,
                    userAnswerIndex: selectedOptionIndex,
                    correctAnswerIndex: q.answerOptions.findIndex(opt => opt.isCorrect)
                });
            });

            return { score, totalQuestions, results, categoryScores };
        }
        
        // --- ãƒ‡ãƒ¼ã‚¿é€ä¿¡é–¢æ•°ï¼ˆGoogleãƒ•ã‚©ãƒ¼ãƒ æ¨™æº–æŠ•ç¨¿ï¼‰ ---
        function sendDataToForm(score, total, percentage, results, categoryScores) {
            
            // ğŸš¨ æŠ•ç¨¿ç”¨ URLã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚
            const FORM_KEY = "1FAIpQLSeZ9tl8zyQQJyUujbDve0uqIcqvDBlJpryP2FyUmvPz-C7r5Q";
            const FORM_POST_URL = `https://docs.google.com/forms/d/e/${FORM_KEY}/formResponse`;

            // âœ… å–å¾—ã—ãŸæ­£ç¢ºãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰IDã‚’çµ„ã¿è¾¼ã¿ã¾ã™
            const ID_USER = 'entry.2125414563'; 
            const ID_SCORE = 'entry.1918104257'; 
            const ID_PERCENTAGE = 'entry.1237722946'; 
            const ID_Q_ANSWERS = 'entry.840212971'; // Q Answers (è¨­å•ã”ã¨æ­£èª¤æ–‡å­—åˆ—)
            
            // 14å€‹ã®ã‚«ãƒ†ã‚´ãƒª Correct/Total ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
            // âš ï¸ ã“ã“ã«æä¾›ã•ã‚ŒãŸIDã‚’æ­£ç¢ºã«ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã¾ã™ âš ï¸
            const CAT_FIELDS = {
                "IDãƒ»è­˜åˆ¥ãƒ»è³‡æ ¼": { C: 'entry.840212971', T: 'entry.840212971' }, // âš ï¸ Q Answersã¨IDãŒé‡ãªã£ã¦ã„ã‚‹ãŸã‚ã€ã“ã“ã§ã¯IDãƒ»è­˜åˆ¥ãƒ»è³‡æ ¼ã¯é€ä¿¡ã—ãªã„
                "èˆªç©ºæ©Ÿå„ªå…ˆãƒ»æ¥è¿‘": { C: 'entry.1691456569', T: 'entry.1535902522' },
                "è»Šä¸¡é‹è¡Œãƒ»ä¸€èˆ¬ãƒ«ãƒ¼ãƒ«": { C: 'entry.856557345', T: 'entry.1422899614' },
                "ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ãƒ¼ãƒ³ãƒ»ç‰¹å®šåŒºåŸŸ": { C: 'entry.163494329', T: 'entry.1719490919' },
                "èˆªç©ºç¯ç«ãƒ»æ–½è¨­ä¿è­·": { C: 'entry.677894160', T: 'entry.1534159982' },
                "FODãƒ»ç’°å¢ƒãƒ»æ–½è¨­ä¿è­·": { C: 'entry.1936399268', T: 'entry.651892569' },
                "ç·Šæ€¥æ™‚ãƒ»é€šå ±": { C: 'entry.319845232', T: 'entry.245318157' },
                "ç®¡åˆ¶ãƒ»ç„¡ç·šãƒ»ä¸€èˆ¬ç¦æ­¢": { C: 'entry.424611051', T: 'entry.1286403520' },
            };
            
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼IDå…¥åŠ› (ä»Šå›ã¯æ™‚åˆ»ã§ä»®å¯¾å¿œ)
            const USER_IDENTIFIER = "ãƒ¦ãƒ¼ã‚¶ãƒ¼_" + new Date().toLocaleTimeString('ja-JP'); 
            
            // Q1-Q10ã®æ­£èª¤ã‚’ã€Œ1ã€ã‹ã€Œ0ã€ã®ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šæ–‡å­—åˆ—ã§ä½œæˆ
            const qAnswersString = results.map(res => res.isCorrect ? "1" : "0").join(','); 

            // ãƒ‡ãƒ¼ã‚¿ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã®æ§‹ç¯‰
            const payload = new URLSearchParams();
            payload.append(ID_USER, USER_IDENTIFIER);
            payload.append(ID_SCORE, `${score}/${total}`);
            payload.append(ID_PERCENTAGE, percentage + '%');
            // Q Answersã‚’é€ä¿¡ (IDã¯ç¢ºå®šæ¸ˆã¿)
            payload.append(ID_Q_ANSWERS, qAnswersString); 

            // 14å€‹ã®å€‹åˆ¥ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ  (IDãƒ»è­˜åˆ¥ãƒ»è³‡æ ¼ã¯ã‚¹ã‚­ãƒƒãƒ—)
            for (const categoryName in categoryScores) {
                // è¨­å•æ•°ãŒ0ã®IDãƒ»è­˜åˆ¥ãƒ»è³‡æ ¼ã¨ã€ãã®ä»–ã‚’ã‚¹ã‚­ãƒƒãƒ—
                if (categoryScores[categoryName].total === 0 || categoryName === "IDãƒ»è­˜åˆ¥ãƒ»è³‡æ ¼" || categoryName === "ãã®ä»–") {
                    continue;
                }

                if (CAT_FIELDS[categoryName]) {
                    const data = categoryScores[categoryName];
                    const fieldIds = CAT_FIELDS[categoryName];
                    
                    // Correctæ•° (C) ã‚’è¿½åŠ  (ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã‚‚ 0 ã‚’é€ä¿¡)
                    payload.append(fieldIds.C, data.correct || 0);
                    
                    // Totalæ•° (T) ã‚’è¿½åŠ  (ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã‚‚ 0 ã‚’é€ä¿¡)
                    payload.append(fieldIds.T, data.total || 0);
                }
            }

            // æœ€çµ‚æŠ•ç¨¿URLã‚’æ§‹ç¯‰
            const finalPostUrl = `${FORM_POST_URL}?${payload.toString()}`;

            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã€ãƒ‡ãƒ¼ã‚¿é€ä¿¡ã‚’å®Ÿè¡Œ
            window.location.href = finalPostUrl; 
        }
        // --- ãƒ‡ãƒ¼ã‚¿é€ä¿¡é–¢æ•° ã“ã“ã¾ã§ ---

        function generateRadarChart(scores) {
            let chart = "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n";
            let radarText = "";
            const maxNameLength = 16;
            const chartScale = 30;

            for (const group in scores) {
                const data = scores[group];
                // ä¿®æ­£: IDãƒ»è­˜åˆ¥ãƒ»è³‡æ ¼ï¼ˆå•é¡Œæ•°0ï¼‰ã®é …ç›®ã¯ã‚°ãƒ©ãƒ•è¡¨ç¤ºã‹ã‚‰é™¤å¤–
                if (data.total === 0 && group !== "IDãƒ»è­˜åˆ¥ãƒ»è³‡æ ¼") continue;

                const rate = data.total > 0 ? data.correct / data.total : 0; // Total 0ã§å‰²ã‚‹ã®ã‚’å›é¿
                const barLength = Math.round(rate * chartScale);
                const bar = "â– ".repeat(barLength) + " ".repeat(chartScale - barLength);
                const percentage = (rate * 100).toFixed(0);
                
                let colorClass = 'low';
                if (rate >= 0.8) {
                    colorClass = 'high';
                } else if (rate >= 0.5) {
                    colorClass = 'mid';
                }

                const paddedName = group.padEnd(maxNameLength, 'ã€€');
                radarText += `<span class="${colorClass}">${paddedName}: [${bar}] ${percentage}%</span>\n`;
            }
            chart += radarText;
            chart += "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n";
            chart += "â– : æ­£ç­”ç‡ãƒãƒ¼ (50%æœªæº€:èµ¤, 50-79%:é»„, 80%ä»¥ä¸Š:ç·‘)\n";
            return chart;
        }


        function showResults() {
            const { score, totalQuestions, results, categoryScores } = calculateResults();
            const percentage = (score / totalQuestions * 100).toFixed(1);
            
            // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã‚’å®Ÿè¡Œ
            sendDataToForm(score, totalQuestions, percentage, results, categoryScores); 
            
            const resultsDiv = document.getElementById('results');
            const radarChart = generateRadarChart(categoryScores);
            resultsDiv.style.display = 'block';

            let analysisHTML = `
                <h2>åˆ†é‡åˆ¥ æ­£ç­”ç‡åˆ†æï¼ˆ8åˆ†é‡ï¼‰</h2>
                <p>ã“ã®çµæœã¯é›†è¨ˆã‚µãƒ¼ãƒãƒ¼ã¸é€ä¿¡ã•ã‚Œã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿ãŒè¨˜éŒ²ã•ã‚ŒãŸå¾Œã€ãƒ–ãƒ©ã‚¦ã‚¶ã®ã€Œæˆ»ã‚‹ã€ãƒœã‚¿ãƒ³ã§ã‚¯ã‚¤ã‚ºã«æˆ»ã‚Œã¾ã™ã€‚</p>
                <div class="analysis-detail">
                    <pre class="radar-chart">${radarChart}</pre>
                </div>
                
                <p style="margin-top: 20px;"><strong>ä¸æ­£è§£å•é¡Œãƒªã‚¹ãƒˆï¼ˆå¾©ç¿’æ¨å¥¨ï¼‰:</strong></p>
                <ul style="text-align: left; margin-left: 20px;">
                ${results.map((res, index) => 
                    !res.isCorrect ? `<li style="color: #dc3545;">å•${index + 1}. [${getCategoryGroup(quizData.questions[index].category)}] ${quizData.questions[index].question}</li>` : ''
                ).join('')}
                </ul>
            `;
            
            resultsDiv.innerHTML = `
                <h2>ã‚¯ã‚¤ã‚ºçµæœæ¦‚è¦</h2>
                <div class="score-info">
                    ${totalQuestions}å•ä¸­ ${score}å•æ­£è§£ï¼
                </div>
                <p>æ­£ç­”ç‡: ${percentage}%</p>
                <button class="submit-btn" onclick="clearLocalStorageAndResetForm()">ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦ã™ã‚‹</button>
                ${analysisHTML}
                <p style="margin-top: 20px;">é›†è¨ˆãƒ‡ãƒ¼ã‚¿ãŒè¨˜éŒ²ã•ã‚ŒãŸå¾Œã€ãƒ–ãƒ©ã‚¦ã‚¶ã®ã€Œæˆ»ã‚‹ã€ãƒœã‚¿ãƒ³ã§ã‚¯ã‚¤ã‚ºã«æˆ»ã‚Šã€çµæœã‚’ç¢ºèªã§ãã¾ã™ã€‚</p>
            `;
            document.getElementById('show-results-btn').style.display = 'none';
        }

        function clearLocalStorageAndResetForm() {
            if (confirm("ã“ã‚Œã¾ã§ã®å›ç­”ãƒ‡ãƒ¼ã‚¿ã‚’æ¶ˆå»ã—ã€æ–°ã—ãã‚¯ã‚¤ã‚ºã‚’é–‹å§‹ã—ã¾ã™ã‹ï¼Ÿ")) {
                quizData.questions.forEach((q, index) => {
                    localStorage.removeItem(`q${index}`);
                });
                document.getElementById('quiz-form').reset();
                location.reload();
            }
        }
        
        document.getElementById('show-results-btn').addEventListener('click', showResults);
        
        renderQuiz();
    </script>
</body>
</html>
